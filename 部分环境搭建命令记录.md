
## 构建openmmlab环境(川大服务器)

conda create -n openmmlab python=3.7

conda install pytorch==1.13.1 torchvision==0.14.1 torchaudio==0.13.1 pytorch-cuda=11.7 -c pytorch -c nvidia

一定要测试一下
import torch
print(torch.cuda.is_available())
返回True才能往下。

git clone https://github.com/open-mmlab/mim

cd mim

pip install -e .

mim install mmengine

mim install 'mmcv>=2.0.0rc4'

mim install 'mmdet>=3.0.0'

mim install "mmdet3d>=1.1.0rc0"

git clone https://github.com/open-mmlab/mmdetection3d

mim download mmdet3d --config pointpillars_hv_secfpn_8xb6-160e_kitti-3d-car --dest .

## 构建Real3D-AD的环境，提交过issue，回复也不友好
https://github.com/M-3LAB/Real3D-AD/issues/7

conda env create -f real3dad.yaml
# Note that point2_ops_lib may need to be installed by the following command：
pip install "git+git://github.com/erikwijmans/Pointnet2_PyTorch.git#egg=pointnet2_ops&subdirectory=pointnet2_ops_lib"

## 依赖M3DM的环境（电子科大服务器首先OK,川大服务器中间有error）
Ubuntu 18.04
Python 3.8
Pytorch 1.9.0
CUDA 11.3

conda config --set ssl_verify False

conda create -n M3DM python=3.8

pip install torch==1.9.0+cu111 torchvision==0.10.0+cu111 torchaudio==0.9.0 -f https://download.pytorch.org/whl/torch_stable.html

git clone https://github.com/nomewang/M3DM

pip install -r requirement.txt

pip install --upgrade https://github.com/unlimblue/KNN_CUDA/releases/download/0.2/KNN_CUDA-0.2-py3-none-any.whl

pip install "git+https://github.com/erikwijmans/Pointnet2_PyTorch.git#egg=pointnet2_ops&subdirectory=pointnet2_ops_lib"

mkdir mvtec_3d_anomaly_detection

tar -xf mvtec_3d_anomaly_detection.tar.xz -C mvtec_3d_anomaly_detection

mkdir datasets
然后将数据

mv mvtec_3d_anomaly_detection.tar.xz datasets/

mkdir -p datasets/mvtec3d/
mv mvtec_3d_anomaly_detection/* datasets/mvtec3d/

处理数据集
python utils/preprocessing.py datasets/mvtec3d/


pip install open3d -i https://pypi.tuna.tsinghua.edu.cn/simple

mkdir checkpoints
然后将.pth文件复制到该文件夹中。

CUDA_VISIBLE_DEVICES=1 python main.py --method_name DINO+Point_MAE --memory_bank multiple --rgb_backbone_name vit_base_patch8_224_dino --xyz_backbone_name Point_MAE --save_feature 

pip install ninja

发现两个问题，一个是huggingface，一个是knn_cuda的问题，必须解决了，这个问题才能解决。

wget https://repo.anaconda.com/archive/Anaconda3-5.3.0-Linux-x86_64.sh


chmod +x Anaconda3-5.3.0-Linux-x86_64.sh

./Anaconda3-5.3.0-Linux-x86_64.sh

source ~/.bashrc

通过测试，感觉knn_cuda在电子科大服务器2上可以用，有望解决。

## 依赖Pointnet2_Pytorch的环境，而这个环境为非官方环境，没有更新了 电子科大服务器
https://github.com/erikwijmans/Pointnet2_PyTorch

conda create -n Pointnet2_PyTorch python=3.7

